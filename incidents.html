<!DOCTYPE html>
<html lang="bg">
<head>
  <meta charset="UTF-8">
  <title>Incidents</title>
  <link rel="stylesheet" href="css/styles.css">
  <link rel="stylesheet" href="css/navbar.css">
  <link rel="stylesheet" href="css/incidents.css">
  <link rel="stylesheet" href="css/theme-toggle.css">
</head>
<body>
  <div class="navbar" id="navbar">
    <a href="index.html">Home</a>
    <a href="information.html">Information</a>
    <a href="employer.html">Employer</a>
    <a href="cars.html">Cars</a>
    <a href="incidents.html" class="active">Incidents</a>
    <a href="statistics.html">Statistics</a>
    <a href="map.html">Map</a>
    <a href="login.html">Log in</a>
    <button class="theme-toggle" onclick="toggleTheme()">
      <span class="theme-icon">üåô</span>
      <span class="theme-text">Dark</span>
    </button>
  </div>

  <div class="content">
    <h1>–†–µ–≥–∏—Å—Ç—Ä–∏—Ä–∞–Ω–µ –Ω–∞ –ø—Ä–æ–∏–∑—à–µ—Å—Ç–≤–∏–µ</h1>
    <form id="incidentForm">
      <label>–¢–∏–ø –ø—Ä–æ–∏–∑—à–µ—Å—Ç–≤–∏–µ:</label>
      <select id="incidentType">
        <option value="–ü–æ–∂–∞—Ä">–ü–æ–∂–∞—Ä</option>
        <option value="–ö–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∞">–ö–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∞</option>
        <option value="–ù–∞–≤–æ–¥–Ω–µ–Ω–∏–µ">–ù–∞–≤–æ–¥–Ω–µ–Ω–∏–µ</option>
      </select><br><br>

      <label>–õ–æ–∫–∞—Ü–∏—è:</label>
      <input type="text" id="location" placeholder="–≥—Ä. –°–æ—Ñ–∏—è, —É–ª. –ü—Ä–∏–º–µ—Ä 1" required><br><br>

      <label>–î–∞—Ç–∞ –∏ —á–∞—Å:</label>
      <input type="datetime-local" id="datetime" required><br><br>

      <button type="submit">–ó–∞–ø–∏—à–∏ –ø—Ä–æ–∏–∑—à–µ—Å—Ç–≤–∏–µ—Ç–æ</button>
    </form>

    <h2>–ê–∫—Ç–∏–≤–Ω–∏ –ø—Ä–æ–∏–∑—à–µ—Å—Ç–≤–∏—è</h2>
    <ul id="incidentList"></ul>
  </div>

  <script>
    const employees = [
      { name: "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤", status: "free" },
      { name: "–ì–µ–æ—Ä–≥–∏ –ì–µ–æ—Ä–≥–∏–µ–≤", status: "free" },
      { name: "–ú–∞—Ä–∏—è –ü–µ—Ç—Ä–æ–≤–∞", status: "free" },
    ];

    const cars = [
      { reg: "CA1234PK", status: "free" },
      { reg: "PB5678KM", status: "free" },
      { reg: "BH9876CH", status: "free" },
    ];

    const form = document.getElementById("incidentForm");
    const list = document.getElementById("incidentList");

    function saveIncidents(data) {
      localStorage.setItem("incidents", JSON.stringify(data));
    }

    function loadIncidents() {
      return JSON.parse(localStorage.getItem("incidents") || "[]");
    }

    function renderIncidents() {
      const incidents = loadIncidents();
      list.innerHTML = "";
      incidents.forEach((i, index) => {
        const li = document.createElement("li");
        li.innerHTML = `
          <strong>${i.type}</strong> –≤ <em>${i.location}</em> <br>
          –î–∞—Ç–∞/—á–∞—Å: ${i.datetime} <br>
          –ò–∑–ø—Ä–∞—Ç–µ–Ω –µ–∫–∏–ø: ${i.employee}, –ê–≤—Ç–æ–º–æ–±–∏–ª: ${i.car}
        `;
        list.appendChild(li);
      });
    }

    form.addEventListener("submit", e => {
      e.preventDefault();

      const type = document.getElementById("incidentType").value;
      const location = document.getElementById("location").value;
      const datetime = document.getElementById("datetime").value;

      const employee = employees.find(e => e.status === "free");
      const car = cars.find(c => c.status === "free");

      if (!employee || !car) {
        alert("–ù—è–º–∞ —Å–≤–æ–±–æ–¥–Ω–∏ —Å–ª—É–∂–∏—Ç–µ–ª–∏ –∏–ª–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª–∏!");
        return;
      }

      employee.status = "busy";
      car.status = "busy";

      const newIncident = {
        type,
        location,
        datetime,
        employee: employee.name,
        car: car.reg
      };

      const incidents = loadIncidents();
      incidents.push(newIncident);
      saveIncidents(incidents);

      renderIncidents();
      form.reset();
    });

    renderIncidents();
  </script>
  <script src="js/theme-toggle.js"></script>
</body>
</html>
